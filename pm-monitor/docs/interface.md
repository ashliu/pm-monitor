# PM-Monitor 界面设计文档

## 整体布局

采用 `QHBoxLayout` 主布局，分为左右两部分：
- **左侧**：操作控制区 (30% 宽度)
- **右侧**：数据显示区 (70% 宽度)

右侧区域再分为上下两部分：
- **右上方**：数值显示 (30% 高度)
- **右下方**：曲线显示 (70% 高度)

## 左侧操作区

### 功能模块

1. **设备连接**
   - 串口选择 (QComboBox)
   - 波特率选择 (QComboBox: 9600, 19200, 38400, 115200)
   - 连接/断开按钮

2. **测量控制**
   - 开始测量按钮 (QPushButton)
   - 停止测量按钮 (QPushButton)
   - 重置数据按钮 (QPushButton)

3. **参数配置**
   - 采样频率 (QSpinBox: 1-1000 Hz)
   - 数据缓冲区大小 (QSpinBox: 100-10000)
   - 显示时间范围 (QSpinBox: 1-60 秒)

4. **导出功能**
   - 导出数据按钮 (QPushButton)
   - 导出格式选择 (CSV, JSON)

### 布局细节

```python
QVBoxLayout
├── QLabel("设备连接")
│   ├── 串口选择
│   ├── 波特率
│   └── 连接按钮
├── QLabel("测量控制")
│   ├── 开始按钮
│   ├── 停止按钮
│   └── 重置按钮
├── QLabel("参数配置")
│   ├── 采样频率
│   ├── 缓冲区大小
│   └── 显示时间范围
└── QLabel("数据导出")
    ├── 导出按钮
    └── 格式选择
```

## 右侧数值显示区

### 显示项

每个数值项包含：标签 + 数值显示 + 单位

1. **当前值 (Current)**
   - 格式：`XXX.XX W`
   - 颜色：绿色（正常）、红色（超限）

2. **最大值 (Maximum)**
   - 格式：`XXX.XX W`
   - 颜色：橙色高亮

3. **最小值 (Minimum)**
   - 格式：`XXX.XX W`
   - 颜色：蓝色高亮

4. **RMS值 (RMS)**
   - 格式：`XXX.XX W`
   - 颜色：紫色高亮
   - 计算公式：`RMS = sqrt(Σx²/n)`

5. **峰值 (Peak)**
   - 格式：`XXX.XX W`
   - 颜色：红色高亮

### 布局细节

```python
QGridLayout (3列x3行)
├── 当前值 | 最大值 | 最小值
├── RMS值 | 峰值   | 平均值
└── 测量时间 | 采样次数 | 状态
```

## 右侧曲线显示区

### 功能特性

- **实时曲线**
  - X 轴：时间 (秒)
  - Y 轴：功率 (瓦特)
  - 自动滚动显示最新数据
  - 支持缩放和平移

- **网格线**
  - 主网格线 (深灰色)
  - 次网格线 (浅灰色)

- **图例**
  - 当前值曲线 (红色实线)
  - 平均值参考线 (蓝色虚线)

### 布局细节

```python
# 使用 pyqtgraph 的 PlotWidget
plot_widget = pg.PlotWidget()
plot_widget.setTitle("功率监测曲线")
plot_widget.setLabel('left', '功率', units='W')
plot_widget.setLabel('bottom', '时间', units='s')
plot_widget.showGrid(x=True, y=True)
plot_widget.addLegend()
```

## 颜色方案

| 元素 | 颜色 | 用途 |
|------|------|------|
| 主背景 | #F0F0F0 | 整体背景 |
| 面板背景 | #FFFFFF | 各区域面板 |
| 边框 | #CCCCCC | 区域分隔 |
| 开始按钮 | #4CAF50 | 开始/启用 |
| 停止按钮 | #F44336 | 停止/禁用 |
| 重置按钮 | #FF9800 | 重置操作 |
| 曲线颜色 | #2196F3 | 数据曲线 |
| 当前值 | #4CAF50 | 正常状态 |
| 最大值 | #FF9800 | 高亮显示 |
| RMS值 | #9C27B0 | 特殊计算值 |

## 状态指示

- **未连接**：所有按钮禁用，显示"未连接设备"
- **已连接**：允许配置参数
- **测量中**：显示实时数据，禁用配置
- **已停止**：显示最后数据，允许导出

## 响应时间

- 界面更新频率：>= 30 FPS (约 33ms)
- 数据采样频率：用户可配置 (1-1000 Hz)
- 曲线刷新：每 100ms 更新一次
